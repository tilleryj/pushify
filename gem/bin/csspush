#!/usr/bin/env ruby
require 'rubygems'
require 'daemons'
require 'juggernaut'

require File.join(File.dirname(__FILE__), "..", "lib", "css_push_server")

# TODO: HACK
pids = File.join('tmp', 'pids')
pid = File.join(pids, 'juggernaut.pid')
if ARGV.include?('start')
  config = File.exist?("config/juggernaut.yml") ? "config/juggernaut.yml" : File.join(File.dirname(__FILE__), "..", "install", "juggernaut.yml")
  system("juggernaut -c#{config} -d -P #{pid}")
else
  system("kill #{File.read(pid)}")
  system("rm #{pid}")
end

Daemons.run_proc(File.join(pids, 'css_push_server.rb')) { CSSPushServer.run }
